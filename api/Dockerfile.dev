FROM python:3.10

ENV PYTHONPATH=/api/src/
ENV POETRY_VIRTUALENVS_CREATE=False

RUN apt update && apt install -y build-essential python-dev python3-pip npm libpq-dev gettext

RUN pip install pip --upgrade
RUN pip install --no-cache-dir poetry pytest pytest-cov

COPY /api/pyproject.toml /api/poetry.lock /api/
RUN cd /api; poetry install

COPY /search/pyproject.toml /search/poetry.lock /search/
RUN cd /search; poetry install

COPY /api /api/
COPY /search /search/
RUN pip install /search

ENTRYPOINT ["/api/docker-entrypoint.dev.sh"]
